FROM alpine:latest

# Install required packages
RUN apk add --no-cache bash rsync coreutils

# Create cron job and start cron in foreground
CMD echo "0 */${BACKUP_INTERVAL} * * * sleep ${BACKUP_OFFSET} && \
  mkdir -p /backup/$(date +\%Y-\%m-\%d_\%H-\%M-\%S) && \
  rsync -av --delete /data/ /backup/$(date +\%Y-\%m-\%d_\%H-\%M-\%S)/" > /etc/crontabs/root \
  && crond -f -L /dev/stdout