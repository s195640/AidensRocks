FROM alpine:latest

# Install required packages
RUN apk add --no-cache bash rsync coreutils

# Create cron job and start cron in foreground
CMD echo "0 */${BACKUP_INTERVAL} * * * sleep ${BACKUP_OFFSET} && \
  TIMESTAMP=\$(date +\%Y-\%m-\%d_\%H-\%M-\%S) && \
  mkdir -p /backup/\$TIMESTAMP && \
  rsync -av /data/ /backup/\$TIMESTAMP/" > /etc/crontabs/root \
  && crond -f -L /dev/stdout
